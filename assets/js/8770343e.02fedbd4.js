"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[6938],{3905:(e,n,t)=>{t.d(n,{Zo:()=>p,kt:()=>y});var a=t(7294);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function o(e,n){if(null==e)return{};var t,a,i=function(e,n){if(null==e)return{};var t,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var s=a.createContext({}),u=function(e){var n=a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},p=function(e){var n=u(e.components);return a.createElement(s.Provider,{value:n},e.children)},d="mdxType",c={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},m=a.forwardRef((function(e,n){var t=e.components,i=e.mdxType,r=e.originalType,s=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),d=u(t),m=i,y=d["".concat(s,".").concat(m)]||d[m]||c[m]||r;return t?a.createElement(y,l(l({ref:n},p),{},{components:t})):a.createElement(y,l({ref:n},p))}));function y(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var r=t.length,l=new Array(r);l[0]=m;var o={};for(var s in n)hasOwnProperty.call(n,s)&&(o[s]=n[s]);o.originalType=e,o[d]="string"==typeof e?e:i,l[1]=o;for(var u=2;u<r;u++)l[u]=t[u];return a.createElement.apply(null,l)}return a.createElement.apply(null,t)}m.displayName="MDXCreateElement"},4127:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>l,default:()=>d,frontMatter:()=>r,metadata:()=>o,toc:()=>u});var a=t(7462),i=(t(7294),t(3905));const r={sidebar_position:1},l="Bundle analysis",o={unversionedId:"recipes/bundle-analysis",id:"version-2.x/recipes/bundle-analysis",title:"Bundle analysis",description:"More often you need to understand how much space you can save using this library. The simplest way for performing this - compare files size. But it's a pretty routine task. So you can save a little bit time and get great bundle analytics using such tools as visualize-bundle and react-native-bundle-visualizer",source:"@site/versioned_docs/version-2.x/recipes/bundle-analysis.md",sourceDirName:"recipes",slug:"/recipes/bundle-analysis",permalink:"/react-native-bundle-splitter/docs/recipes/bundle-analysis",draft:!1,editUrl:"https://github.com/kirillzyusko/react-native-bundle-splitter/tree/master/docs/versioned_docs/version-2.x/recipes/bundle-analysis.md",tags:[],version:"2.x",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Recipes",permalink:"/react-native-bundle-splitter/docs/category/recipes"},next:{title:"Capturing startup time",permalink:"/react-native-bundle-splitter/docs/recipes/capturing-startup-time"}},s={},u=[{value:"Bundle analysis",id:"bundle-analysis-1",level:2},{value:"Visualization of the bundle",id:"visualization-of-the-bundle",level:3},{value:"Analysis of the bundle",id:"analysis-of-the-bundle",level:3},{value:"Analysis of the content in <code>packager</code> folder",id:"analysis-of-the-content-in-packager-folder",level:2},{value:"Summary",id:"summary",level:2}],p={toc:u};function d(e){let{components:n,...r}=e;return(0,i.kt)("wrapper",(0,a.Z)({},p,r,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"bundle-analysis"},"Bundle analysis"),(0,i.kt)("p",null,"More often you need to understand how much space you can save using this library. The simplest way for performing this - compare files size. But it's a pretty routine task. So you can save a little bit time and get great bundle analytics using such tools as ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/JonnyBurger/npx-visualize-bundle"},"visualize-bundle")," and ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/IjzerenHein/react-native-bundle-visualizer"},"react-native-bundle-visualizer")),(0,i.kt)("h2",{id:"bundle-analysis-1"},"Bundle analysis"),(0,i.kt)("h3",{id:"visualization-of-the-bundle"},"Visualization of the bundle"),(0,i.kt)("p",null,"Since ",(0,i.kt)("inlineCode",{parentName:"p"},"react-native-bundle-visualizer")," has some issues with typescript I recommend you use ",(0,i.kt)("inlineCode",{parentName:"p"},"visualize-bundle")," library.\nFirst of all you need to install it:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"yarn add visualize-bundle --dev\n# or with npm\n# npm install visualize-bundle --save-dev\n")),(0,i.kt)("p",null,"After installation edit your ",(0,i.kt)("inlineCode",{parentName:"p"},"package.json"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-diff"},'{\n  "scripts": {\n+      "bundle:analysis": "visualize-bundle"\n  }\n}\n')),(0,i.kt)("p",null,"And then run analyzer:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"In one terminal:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"react-native start\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"In the second terminal")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"yarn run bundle:analysis\n# or with npm\n# npm run bundle:analysis\n")),(0,i.kt)("p",null,"You will see something like this:"),(0,i.kt)("img",{src:t(340).Z,alt:"Bundle Visualizer Report"}),(0,i.kt)("p",null,"It looks terrible, but let's see a little bit deeply into this picture."),(0,i.kt)("h3",{id:"analysis-of-the-bundle"},"Analysis of the bundle"),(0,i.kt)("p",null,"First of all you need to look at big rectangles, since they are the most significant. In this picture you can see, that in ",(0,i.kt)("inlineCode",{parentName:"p"},"node_modules")," you have several libraries, with pretty big size, such as ",(0,i.kt)("inlineCode",{parentName:"p"},"moment"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"lodash"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"react-native-firebase")," and others. On other hand we have pretty big ",(0,i.kt)("inlineCode",{parentName:"p"},"assets")," folder and ",(0,i.kt)("inlineCode",{parentName:"p"},"src")," (screens and components)."),(0,i.kt)("p",null,"And here is few tactics for proper splitting the final bundle:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"As an alternative for ",(0,i.kt)("inlineCode",{parentName:"li"},"moment")," you can select any other library that will fit for your goals and require less memory"),(0,i.kt)("li",{parentName:"ul"},"For ",(0,i.kt)("inlineCode",{parentName:"li"},"lodash")," you can use not absolute import and import each function as a separate (instead of ",(0,i.kt)("inlineCode",{parentName:"li"},"import { isEqual } from 'lodash'")," you can write ",(0,i.kt)("inlineCode",{parentName:"li"},"import isEqual from 'lodash/isEqual'"),")"),(0,i.kt)("li",{parentName:"ul"},"Firebase from ",(0,i.kt)("inlineCode",{parentName:"li"},"6.0.0")," version is not monorepo and for every feature (notification/crashlytics etc) you can use separate package"),(0,i.kt)("li",{parentName:"ul"},"All yours code and assets you can wrap in HOC provided by ",(0,i.kt)("inlineCode",{parentName:"li"},"react-native-bundle-splitter")," and it should reduce the size of initial loaded bundle")),(0,i.kt)("p",null,"It's common tactics that you may apply in order to simplify your entry point of an application."),(0,i.kt)("h2",{id:"analysis-of-the-content-in-packager-folder"},"Analysis of the content in ",(0,i.kt)("inlineCode",{parentName:"h2"},"packager")," folder"),(0,i.kt)("p",null,"In this folder you should have ",(0,i.kt)("inlineCode",{parentName:"p"},"modules.android.js")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"modules.ios.js")," files. If you open any of them and will try to search for ",(0,i.kt)("inlineCode",{parentName:"p"},"/node_modules")," you may find a lot of matches."),(0,i.kt)("img",{src:t(5809).Z,alt:"Search result of node_modules word"}),(0,i.kt)("p",null,"In the example above we see, that ",(0,i.kt)("inlineCode",{parentName:"p"},"react-native")," uses different versions of ",(0,i.kt)("inlineCode",{parentName:"p"},"@babel/runtime")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"fbjs"),". It often happens, when you have a large project with a lot of 3rd party dependencies. And all of these libraries use different versions of common libraries."),(0,i.kt)("p",null,'Because of this, tree dependency becomes complicated and bundle grows because of "duplication" of dependencies. But it can be easily fixed, if you dig into ',(0,i.kt)("inlineCode",{parentName:"p"},"package-lock.json"),"/",(0,i.kt)("inlineCode",{parentName:"p"},"yarn.lock")," file and manually re-organize dependency tree. For ",(0,i.kt)("inlineCode",{parentName:"p"},"package-lock.json")," you may follow ",(0,i.kt)("a",{parentName:"p",href:"https://stackoverflow.com/a/48524488/9272042"},"this")," instruction. And for ",(0,i.kt)("inlineCode",{parentName:"p"},"yarn.lock")," you may use ",(0,i.kt)("a",{parentName:"p",href:"https://classic.yarnpkg.com/en/docs/selective-version-resolutions/"},"resolutions")," approach."),(0,i.kt)("p",null,'Thus, by explicitly specifying common dependencies for some packages, you can avoid "duplication" (when the same package is used many times but with different versions) and make your bundle smaller.'),(0,i.kt)("h2",{id:"summary"},"Summary"),(0,i.kt)("p",null,"The main goal of this article is to demonstrate a way for determining the order and prioritizing thing where you should work. Via visualization of bundle you can understand, what exactly may slow down your startup of an application and understand possible way for resolving it."))}d.isMDXComponent=!0},340:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/bundle-visualizer-before-676140ed3c85fca992b793fcc23d9cab.png"},5809:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/nested-node-modules-8d3aa8124c5850d87967f352fcaacb35.png"}}]);